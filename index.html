<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="./assets/unblot_logo.png">
  <title>Unblot</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!-- Tailwind CSS via CDN -->
  <!-- Custom cursor & cozy literature-inspired global styles -->
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@500;700&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* Force hide utility for elements that Tailwind overrides */
    .force-hide { display: none !important; }
    :root {
      --quill-cursor: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMTAgMzYgUTE4IDE4IDM0IDYgUTM2IDQgMzcgNyBRMzggMTAgMzYgMTMgUTMyIDE5IDIyIDI4IFExNiAzMyAxMCAzNiBaIiBmaWxsPSIjNDRiZmEzIiBzdHJva2U9IiMyNTYzZWIiIHN0cm9rZS13aWR0aD0iMiIvPgogIDxwYXRoIGQ9Im0xMyAzMyBRMjAgMjUgMzIgMTMiIHN0cm9rZT0iIzI1NjNlYiIgc3Ryb2tlLXdpZHRoPSIyLjIiIGZpbGw9Im5vbmUiLz4KPC9zdmc+') 20 20, auto;
      --main-blue: #2563eb;
      --main-blue-light: #e0e7ff;
      --main-bg: #f8fafc;
      --paper: #fff;
      --shadow: 0 4px 24px 0 rgba(37,99,235,0.07);
    }
    html, body {
      height: 100%;
      background: var(--main-bg);
      font-family: 'Quicksand', 'Segoe UI', Arial, sans-serif;
      color: #1e293b;
      cursor: var(--quill-cursor);
    }
    h1, h2, h3, .poem-title, .poem-content {
      font-family: 'EB Garamond', serif;
      letter-spacing: 0.01em;
    }
    .poem-content {
      font-size: 1.15rem;
      line-height: 1.7;
      color: #334155;
      background: var(--paper);
      border-radius: 1.2em 1.2em 1.2em 1.2em/1.5em 1.5em 1.2em 1.2em;
      box-shadow: var(--shadow);
      padding: 1.5em 2em;
      margin: 1.5em 0;
    }
    nav {
      background: linear-gradient(90deg, var(--main-blue-light) 0%, #fff 100%);
      box-shadow: var(--shadow);
      border-bottom: 2px solid var(--main-blue-light);
    }
    .nav-title {
      font-family: 'EB Garamond', serif;
      font-size: 2rem;
      color: var(--main-blue);
      letter-spacing: 0.04em;
      text-shadow: 0 2px 8px #e0e7ff;
    }
    .nav-btn {
      background: var(--main-blue-light);
      color: var(--main-blue);
      border-radius: 0.7em;
      padding: 0.4em 1.1em;
      font-weight: 600;
      font-family: 'Quicksand', Arial, sans-serif;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px 0 rgba(37,99,235,0.04);
      border: none;
      cursor: var(--quill-cursor);
    }
    .side-nav-btn {
      border-radius: 0 !important;
      border: none !important;
      box-shadow: none !important;
      margin: 0.2em 0;
      background: none;
      color: var(--main-blue);
      transition: background 0.2s, color 0.2s;
    }
    .side-nav-btn.active {
      background: #e0e7ff !important;
      color: #2563eb !important;
    }
    /* Responsive styles for mobile */
    @media (max-width: 700px) {
      .header-tagline {
        display: none !important;
      }
      .nav-title {
        font-size: 1.2rem;
        margin-bottom: 0;
        flex-direction: row;
        align-items: center;
        gap: 0.5em;
      }
      .nav-title .flex {
        flex-direction: row;
        align-items: center;
        gap: 0.5em;
      }
      .nav-title .text-xs {
        margin-left: 0.5em !important;
        font-size: 0.8rem;
        white-space: nowrap;
      }
      .hamburger {
        display: flex;
        align-items: center;
        margin-left: 0.5em;
      }
      .nav-actions {
        display: none !important;
      }
      #side-panel {
        box-shadow: 0 8px 32px 0 rgba(37,99,235,0.10);
        border-radius: 0 1.5em 1.5em 0;
        min-width: 220px;
        max-width: 80vw;
        width: 70vw;
        background: #fff;
        padding-top: 0;
        padding-bottom: 0;
      }
      #side-panel .side-nav-btn {
        background: none;
        color: #2563eb;
        font-size: 1.1rem;
        text-align: left;
        padding: 1rem 2rem;
        border-radius: 0;
        transition: background 0.2s;
      }
      #side-panel .side-nav-btn.active, #side-panel .side-nav-btn:focus, #side-panel .side-nav-btn:hover {
        background: #e0e7ff !important;
        color: #2563eb !important;
      }
      #side-panel .font-bold {
        font-family: 'EB Garamond', serif;
      }
      #header-search-form {
        display: none !important;
      }
      #header-search-icon {
        display: flex !important;
      }
    }
    @media (min-width: 701px) {
      .hamburger {
        display: none;
      }
      .nav-actions {
        display: flex !important;
        flex-direction: row;
        position: static;
        background: none;
        box-shadow: none;
      }
      #header-search-form {
        display: flex !important;
      }
      #header-search-icon {
        display: none !important;
      }
    }
    .nav-btn:hover, .nav-btn:focus {
      background: var(--main-blue);
      color: #fff;
      box-shadow: 0 4px 16px 0 rgba(37,99,235,0.10);
    }
    .cozy-card {
      background: var(--paper);
      border-radius: 1.2em 1.2em 1.2em 1.2em/1.5em 1.5em 1.2em 1.2em;
      box-shadow: var(--shadow);
      padding: 2em 2.5em;
      margin: 2em 0;
    }
    ::selection {
      background: #e0e7ff;
    }
    /* Custom scroll for cozy feel */
    ::-webkit-scrollbar {
      width: 10px;
      background: #e0e7ff;
    }
    ::-webkit-scrollbar-thumb {
      background: #a5b4fc;
      border-radius: 6px;
    }
  </style>
  <!-- Load .env values into window for browser modules -->
  <script src="./env.loader.js"></script>
  <!-- Supabase JS via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col" style="min-height: 100vh;">
  <!-- Navigation -->
  <nav class="flex justify-between items-center p-4 fixed top-0 left-0 w-full z-50 bg-gradient-to-r from-blue-100 to-white shadow border-b-2 border-blue-100" style="background: linear-gradient(90deg, var(--main-blue-light) 0%, #fff 100%);">
    <div id="nav-title" class="nav-title flex flex-col items-start gap-0" style="cursor:pointer;">
      <div class="flex items-center gap-2">
        <img src="./assets/unblot_logo.png" alt="Unblot Logo" width="38" height="38" class="inline-block align-middle" />
        <strong>Unblot</strong>
      </div>
      <div class="text-xs italic text-blue-700 ml-10 header-tagline" style="font-family: 'EB Garamond', serif;">For the words that won't disappear.</div>
    </div>
    <!-- Search bar for desktop -->
    <form id="header-search-form" class="hidden md:flex items-center ml-4" style="flex:1;max-width:320px;" autocomplete="off">
      <input id="header-search-input" type="text" placeholder="Search entries..." class="border border-blue-200 rounded-lg px-3 py-1 w-full focus:outline-none focus:ring-2 focus:ring-blue-300" style="font-family:'Quicksand',Arial,sans-serif;" />
      <button type="submit" class="ml-2 px-3 py-1 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200" aria-label="Search">
        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      </button>
    </form>
    <!-- Mobile searchbar, hidden by default -->
    <form id="header-search-form-mobile" class="flex md:hidden items-center ml-2 hidden" style="flex:1;max-width:320px;" autocomplete="off">
      <input id="header-search-input-mobile" type="text" placeholder="Search entries..." class="border border-blue-200 rounded-lg px-3 py-1 w-full focus:outline-none focus:ring-2 focus:ring-blue-300" style="font-family:'Quicksand',Arial,sans-serif;" />
      <button type="submit" class="ml-2 px-3 py-1 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200" aria-label="Search">
        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      </button>
    </form>
    <!-- Hamburger and search icon for mobile -->
    <div class="flex md:hidden items-center ml-2">
      <button id="header-search-icon" class="flex items-center justify-center p-2 rounded-lg bg-blue-100 text-blue-700" aria-label="Search" style="height:40px;width:40px;">
        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      </button>
      <button class="hamburger flex flex-col justify-center items-center w-10 h-10 bg-transparent border-none cursor-pointer" aria-label="Open navigation" id="hamburger-menu" style="margin-left:4px;">
        <span style="width:24px;height:3px;background:#2563eb;margin:3px 0;border-radius:2px;display:block;"></span>
        <span style="width:24px;height:3px;background:#2563eb;margin:3px 0;border-radius:2px;display:block;"></span>
        <span style="width:24px;height:3px;background:#2563eb;margin:3px 0;border-radius:2px;display:block;"></span>
      </button>
    </div>
    <div class="nav-actions flex gap-3 flex-col md:flex-row absolute md:static right-4 top-16 bg-white md:bg-transparent shadow md:shadow-none rounded md:rounded-none p-4 md:p-0 transition-all duration-300 ease-in-out" id="nav-actions" style="display:none;">
      <button id="nav-login" class="nav-btn">Login</button>
      <button id="nav-register" class="nav-btn">Register</button>
      <button id="nav-discover" class="nav-btn">Discover</button>
      <button id="nav-my-poems" class="nav-btn">By You</button>
      <button id="nav-add-poem" class="nav-btn">Add Poem</button>
      <button id="nav-logout" class="nav-btn" style="color:#dc2626;">Logout</button>
      <span id="current-user-id" class="ml-2 text-gray-500" style="display:none;"></span>
    </div>
    <!-- Side panel for mobile nav -->
    <div id="side-panel" class="fixed top-0 left-0 h-full w-64 bg-white shadow-lg z-50 transform -translate-x-full transition-transform duration-300 ease-in-out flex flex-col justify-between md:hidden" style="max-width:80vw;">
      <div class="flex flex-col gap-0 pt-12">
        <button id="nav-login-mobile" class="nav-btn side-nav-btn">Login</button>
        <button id="nav-register-mobile" class="nav-btn side-nav-btn">Register</button>
        <button id="nav-discover-mobile" class="nav-btn side-nav-btn">Discover</button>
        <button id="nav-my-poems-mobile" class="nav-btn side-nav-btn">By You</button>
        <button id="nav-add-poem-mobile" class="nav-btn side-nav-btn">Add Poem</button>
        <a href="./assets/UnblotAndroid.apk" download class="nav-btn side-nav-btn" style="text-decoration:none; display:inline-flex; align-items:center; gap:0.5em;">Download APK</a>
        <button id="nav-logout-mobile" class="nav-btn side-nav-btn" style="color:#dc2626;">Logout</button>
      </div>
      <div class="flex flex-row items-center justify-center gap-3 mb-8">
        <img src="./assets/unblot_logo.png" alt="Unblot Logo" width="50" height="50" class="inline-block align-left" />
        <div class="font-bold text-blue-700 text-2xl" style="font-size:2rem;">Unblot</div>
      </div>
    </div>
  </nav>

  <!-- Loading Indicator -->
  <div id="loading-indicator" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-30 z-50 hidden">
    <div class="loader ease-linear rounded-full border-8 border-t-8 border-blue-200 h-16 w-16 shadow-lg" style="border-top-color: var(--main-blue);"></div>
    <style>
      .loader {
        border-top-color: var(--main-blue);
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </div>

  <!-- Modal -->
  <div id="modal-bg" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div id="modal" class="cozy-card" style="max-width: 95vw; min-width: 320px; border: 2px solid var(--main-blue-light);">
      <div id="modal-message" class="mb-4 text-lg font-serif text-blue-900"></div>
      <div id="modal-actions" class="flex justify-end gap-2"></div>
    </div>
  </div>

  <!-- Main Content Container for App -->
  <main class="flex-1 flex flex-col" style="padding-top:6.5rem;">
    <div id="app" class="flex flex-col items-center justify-center w-full h-full py-8 px-2 sm:px-0" style="max-width:700px; margin:0 auto;"></div>
  </main>

  <!-- Footer -->
  <footer class="w-full flex flex-col items-center justify-center py-1 mt-auto" style="background: var(--main-blue-light); border-top: 2px solid #e0e7ff;">
    <div class="text-s italic text-blue-700 ml-1" style="font-family: 'EB Garamond', serif;">Unsaid but Written.</div>
    <div class="text-xs text-gray-500 mt-1">&copy; 2025 @_stillgio</div>

  </footer>

  <!-- Poetry Share App Modules -->
  <script type="module" src="./env.js"></script>
  <script type="module" src="./dom.js"></script>
  <script type="module" src="./utils.js"></script>
  <script type="module" src="./auth.js"></script>
  <script type="module" src="./router.js"></script>
  <script type="module" src="./main.js"></script>
  <script>
    // Utility to show/hide nav buttons based on login state
    window.setNavAuthState = function setNavAuthState(isLoggedIn) {
      // Mobile nav only (desktop uses hidden class via updateNav)
      const show = el => el.classList.remove('hidden');
      const hide = el => el.classList.add('hidden');
      // Always show discover
      show(document.getElementById('nav-discover-mobile'));
      // Desktop nav actions
      const navLogout = document.getElementById('nav-logout');
      if (isLoggedIn) {
        hide(document.getElementById('nav-login-mobile'));
        hide(document.getElementById('nav-register-mobile'));
        show(document.getElementById('nav-my-poems-mobile'));
        show(document.getElementById('nav-add-poem-mobile'));
        show(document.getElementById('nav-logout-mobile'));
        if (navLogout) navLogout.style.display = '';
      } else {
        show(document.getElementById('nav-login-mobile'));
        show(document.getElementById('nav-register-mobile'));
        hide(document.getElementById('nav-my-poems-mobile'));
        hide(document.getElementById('nav-add-poem-mobile'));
        hide(document.getElementById('nav-logout-mobile'));
        if (navLogout) navLogout.style.display = 'none';
      }
    }

    // Clickable nav title/logo to go to homepage
    document.addEventListener('DOMContentLoaded', function() {
      // Mobile search toggle logic
      const searchIcon = document.getElementById('header-search-icon');
      const searchFormMobile = document.getElementById('header-search-form-mobile');
      const searchInputMobile = document.getElementById('header-search-input-mobile');
      if (searchIcon && searchFormMobile && searchInputMobile) {
        // Show search bar, remove icon from DOM
        const searchIconParent = searchIcon.parentNode;
        let searchIconNextSibling = searchIcon.nextSibling;
        searchIcon.addEventListener('click', function() {
          if (searchIcon.parentNode) {
            searchIconParent.removeChild(searchIcon);
          }
          setTimeout(function() {
            searchFormMobile.classList.remove('hidden');
            searchInputMobile.focus();
          }, 0);
        });
        // Hide search bar, show icon on blur or submit
        searchFormMobile.addEventListener('submit', function(e) {
          searchFormMobile.classList.add('hidden');
          // Re-insert search icon if not present
          if (!document.getElementById('header-search-icon')) {
            if (searchIconNextSibling) {
              searchIconParent.insertBefore(searchIcon, searchIconNextSibling);
            } else {
              searchIconParent.appendChild(searchIcon);
            }
          }
        });
        searchInputMobile.addEventListener('blur', function() {
          setTimeout(function() {
            if (document.activeElement !== searchInputMobile) {
              searchFormMobile.classList.add('hidden');
              // Re-insert search icon if not present
              if (!document.getElementById('header-search-icon')) {
                if (searchIconNextSibling) {
                  searchIconParent.insertBefore(searchIcon, searchIconNextSibling);
                } else {
                  searchIconParent.appendChild(searchIcon);
                }
              }
            }
          }, 100);
        });
      }
      const navTitle = document.getElementById('nav-title');
      if (navTitle) {
        navTitle.addEventListener('click', function() {
          window.location.hash = '';
        });
      }
      // Hamburger menu toggle for mobile (side panel)
      const hamburger = document.getElementById('hamburger-menu');
      const sidePanel = document.getElementById('side-panel');
      // Open side panel
      hamburger.addEventListener('click', function() {
        sidePanel.classList.add('open');
        sidePanel.style.transform = 'translateX(0)';
      });

      // Hide mobile search icon after click
      // ...existing code...
      // Close side panel on click outside or swipe
      document.addEventListener('mousedown', function(e) {
        if (window.innerWidth <= 700 && sidePanel.classList.contains('open')) {
          if (!sidePanel.contains(e.target) && !hamburger.contains(e.target)) {
            sidePanel.classList.remove('open');
            sidePanel.style.transform = '';
          }
        }
      });
      // Navigation actions for side panel (mobile)
      document.getElementById('nav-login-mobile').addEventListener('click', function() { window.location.hash = 'login'; sidePanel.classList.remove('open'); sidePanel.style.transform = ''; });
      document.getElementById('nav-register-mobile').addEventListener('click', function() { window.location.hash = 'register'; sidePanel.classList.remove('open'); sidePanel.style.transform = ''; });
      document.getElementById('nav-discover-mobile').addEventListener('click', function() { window.location.hash = 'discover'; sidePanel.classList.remove('open'); sidePanel.style.transform = ''; });
      document.getElementById('nav-my-poems-mobile').addEventListener('click', function() { window.location.hash = 'my-poems'; sidePanel.classList.remove('open'); sidePanel.style.transform = ''; });
      document.getElementById('nav-add-poem-mobile').addEventListener('click', function() { window.location.hash = 'add-poem'; sidePanel.classList.remove('open'); sidePanel.style.transform = ''; });
      document.getElementById('nav-logout-mobile').addEventListener('click', async function() {
        try {
          // Dynamically import the logout logic from main.js
          const main = await import('./main.js');
          if (main && typeof main.handleLogout === 'function') {
            await main.handleLogout();
          } else {
            // fallback: go to home
            window.location.hash = '#home';
          }
        } catch (e) {
          window.location.hash = '#home';
        }
        sidePanel.classList.remove('open');
        sidePanel.style.transform = '';
      });
      // Hide side panel on resize
      window.addEventListener('resize', function() {
        if (window.innerWidth > 700) {
          sidePanel.classList.remove('open');
          sidePanel.style.transform = '';
        }
      });
      // setNavAuthState is now called automatically by updateNav in auth.js
    });
  </script>
</body>
</html>
